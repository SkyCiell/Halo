<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detail Produk</title>
    <link href="src/output.css" rel="stylesheet" />
    <script src="api.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
    />
  </head>
  <body class="bg-[#263034] text-[#d1b892] font-sans">
    <!-- Header -->
    <header class="flex flex-col items-center py-6 mb-8">
      <div class="flex w-full max-w-7xl items-center justify-between px-8">
        <a
          href="homepage.html"
          class="flex items-center border border-[#d1b892] px-5 py-2.5 rounded-full text-sm hover:bg-[#d1b892] hover:text-[#263034] text-[#d1b892]"
        >
          <span class="mr-1">&larr;</span> Kembali
        </a>
        <nav class="flex items-center gap-6 text-sm font-medium text-[#d1b892]">
          <a href="homepage.html #top" class="hover:underline">Beranda</a>
          <a href="homepage.html #featured" class="hover:underline">Produk</a>
          <a href="homepage.html #categories" class="hover:underline"
            >Katalog</a
          >
        </nav>
        <div class="w-1/3 mx-auto">
          <div
            class="flex items-center bg-[#263034] border border-[#d1b892] rounded-full px-4 py-2"
          >
            <input
              type="text"
              placeholder="Cari produk..."
              class="w-full text-sm outline-none bg-transparent text-[#d1b892] placeholder-[#d1b892]"
            />
            <svg
              class="w-5 h-5 text-[#d1b892] ml-2"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              viewBox="0 0 24 24"
            >
              <circle cx="11" cy="11" r="8" />
              <path d="M21 21l-4.35-4.35" />
            </svg>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main
      class="max-w-7xl mx-auto px-8 grid grid-cols-1 md:grid-cols-2 gap-16 items-start"
    >
      <!-- Gambar Produk -->
      <div class="flex flex-col items-center">
        <img
          id="productImage"
          src=""
          alt="Product"
          class="w-64 h-64 object-contain mb-6 rounded-lg shadow"
        />
      </div>

      <!-- Informasi Produk -->
      <div class="flex flex-col items-start justify-center px-4 md:px-0">
        <h1
          id="productTitle"
          class="text-4xl font-bold mb-2 text-[#d1b892]"
        ></h1>
        <p id="productCategory" class="text-lg mb-4 text-[#d1b892]"></p>
        <p id="productPrice" class="text-2xl font-bold mb-4 text-[#d1b892]"></p>
        <div class="flex items-center mb-4">
          <div id="ratingStars" class="flex text-[#d1b892]"></div>
          <span id="ratingCount" class="ml-2 text-[#d1b892]"></span>
        </div>
        <p id="productDescription" class="text-[#d1b892] mb-6"></p>
        <!-- Tombol -->
        <button
          class="bg-[#d1b892] text-[#263034] px-8 py-4 rounded-md shadow hover:bg-[#c0a883] text-lg font-medium mt-4 w-full max-w-xs add-to-cart-btn cursor-pointer transition-colors"
        >
          Tambah ke Keranjang
        </button>

        <button
          onclick="checkoutNow()"
          class="bg-[#d1b892] text-[#263034] px-8 py-4 rounded-md shadow hover:bg-[#c0a883] text-lg font-medium mt-4 w-full max-w-xs cursor-pointer transition-colors"
        >
          Checkout Sekarang
        </button>
      </div>
    </main>

    <script>
      // Ambil ID produk dari URL
      const urlParams = new URLSearchParams(window.location.search);
      const productId = urlParams.get("id");
      let currentProduct = null;

      // Ambil data produk dari API
      async function getProductDetail() {
        try {
          const response = await fetch(
            `https://fakestoreapi.com/products/${productId}`
          );
          const product = await response.json();
          currentProduct = product;

          // Tampilkan data produk
          document.getElementById("productImage").src = product.image;
          document.getElementById("productTitle").textContent = product.title;
          document.getElementById("productCategory").textContent =
            product.category;
          document.getElementById(
            "productPrice"
          ).textContent = `$${product.price.toFixed(2)}`;
          document.getElementById("productDescription").textContent =
            product.description;

          // Tampilkan rating
          const ratingStars = document.getElementById("ratingStars");
          const fullStars = Math.floor(product.rating.rate);
          const hasHalfStar = product.rating.rate % 1 >= 0.5;

          for (let i = 0; i < 5; i++) {
            const star = document.createElement("i");
            if (i < fullStars) {
              star.className = "ri-star-fill text-[#d1b892]";
            } else if (i === fullStars && hasHalfStar) {
              star.className = "ri-star-half-fill text-[#d1b892]";
            } else {
              star.className = "ri-star-line text-[#d1b892]";
            }
            ratingStars.appendChild(star);
          }

          document.getElementById(
            "ratingCount"
          ).textContent = `(${product.rating.count})`;
        } catch (error) {
          console.error("Error fetching product:", error);
        }
      }

      // Fungsi untuk menambahkan ke keranjang
      function addToCart() {
        if (!currentProduct) return;

        // Ambil keranjang dari localStorage
        const cart = JSON.parse(localStorage.getItem("cart")) || [];

        // Cek apakah produk sudah ada di keranjang
        const existingItem = cart.find((item) => item.id === currentProduct.id);

        if (existingItem) {
          // Jika sudah ada, tambah quantity
          existingItem.quantity += 1;
        } else {
          // Jika belum ada, tambah item baru
          cart.push({
            id: currentProduct.id,
            title: currentProduct.title,
            price: currentProduct.price,
            image: currentProduct.image,
            quantity: 1,
          });
        }

        // Simpan kembali ke localStorage
        localStorage.setItem("cart", JSON.stringify(cart));

        // Update cart count
        updateCartCount();

        // Tampilkan alert
        alert("Produk berhasil ditambahkan ke keranjang!");
      }

      // Fungsi untuk checkout langsung
      function checkoutNow() {
        if (!currentProduct) return;

        // Simpan item ke localStorage untuk checkout
        const checkoutItem = {
          id: currentProduct.id,
          title: currentProduct.title,
          price: currentProduct.price,
          image: currentProduct.image,
          quantity: 1,
        };

        localStorage.setItem("detailItem", JSON.stringify(checkoutItem));

        // Redirect ke halaman checkout
        window.location.href = "checkout.html";
      }

      // Function to update cart count
      function updateCartCount() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce(
          (total, item) => total + item.quantity,
          0
        );
        const cartCountElements = document.querySelectorAll(".cart-count");
        cartCountElements.forEach((element) => {
          element.textContent = totalItems;
        });
      }

      // Update cart count when page loads
      document.addEventListener("DOMContentLoaded", () => {
        getProductDetail();
        const addToCartBtn = document.querySelector(".add-to-cart-btn");
        addToCartBtn.addEventListener("click", addToCart);
        updateCartCount();
      });
    </script>
  </body>
</html>
